#
# Yet Another UserAgent Analyzer
# Copyright (C) 2013-2019 Niels Basjes
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# https://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an AS IS BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Cortex customized rules
config:
  # ---- Amazon Music specific rules
  # AmazonMusic - Android app - should be categorised as AmazonMusic, Android, Mobile
  - matcher:
      require:
        - 'agent.text="AmazonMusic"'
      extract:
        - 'AgentName                         :   2001 : "Amazon Music"'
        - 'OperatingSystemName               :   2001 : "Android"'
        - 'DeviceClass                       :   2001 : "Mobile"'
  - test:
      input:
        user_agent_string: 'AmazonMusic'
      expected:
        AgentName                            : 'Amazon Music'
        OperatingSystemName                  : 'Android'
        DeviceClass                          : 'Mobile'

  # AmazonMusic/9.15.2 iPhone11,8 CFNetwork/1128.0.1 Darwin/19.6.0 - iOS app - should be categorised as AmazonMusic, iOS, Phone
  - matcher:
      require:
        - 'agent.(1)product.(1)name="AmazonMusic"'
        - 'agent.(2)product.(1)name{"iPhone"'
      extract:
        - 'AgentName                         :   2001 : "Amazon Music"'
        - 'OperatingSystemName               :   2001 : "iOS"'
        - 'DeviceClass                       :   2001 : "Phone"'
  - test:
      input:
        user_agent_string: 'AmazonMusic/9.15.2 iPhone11,8 CFNetwork/1128.0.1 Darwin/19.6.0'
      expected:
        AgentName                            : 'Amazon Music'
        OperatingSystemName                  : 'iOS'
        DeviceClass                          : 'Phone'

  # AmazonMusic/9.15.2 iPad6,11 CFNetwork/1128.0.1 Darwin/19.6.0 - iOS app - should be categorised as AmazonMusic, iOS, Tablet
  - matcher:
      require:
        - 'agent.(1)product.(1)name="AmazonMusic"'
        - 'agent.(2)product.(1)name{"iPad"'
      extract:
        - 'AgentName                         :   2001 : "Amazon Music"'
        - 'OperatingSystemName               :   2001 : "iOS"'
        - 'DeviceClass                       :   2001 : "Tablet"'
  - test:
      input:
        user_agent_string: 'AmazonMusic/9.15.2 iPad6,11 CFNetwork/1128.0.1 Darwin/19.6.0'
      expected:
        AgentName                            : 'Amazon Music'
        OperatingSystemName                  : 'iOS'
        DeviceClass                          : 'Tablet'

  # AmazonMusic/16.17.1 Dalvik/2.1.0 (Linux; U; Android 10; SM-N986U Build/QP1A.190711.020) - Android app - should be categorised as AmazonMusic, Android, Mobile (or Phone when device is known to be Phone to yauaa)
  - matcher:
      require:
        - 'agent.(1)product.(1)name="AmazonMusic"'
        - 'agent.(2)product.(1)comments~"Android"'
      extract:
        - 'AgentName                         :   2001 : "Amazon Music"'
        - 'OperatingSystemName               :   2001 : "Android"'
        - 'DeviceClass                       :   1 : "Mobile"'
  # Known Android phone
  - test:
      input:
        user_agent_string: 'AmazonMusic/16.17.1 Dalvik/2.1.0 (Linux; U; Android 10; SM-N986U Build/QP1A.190711.020)'
      expected:
        AgentName                            : 'Amazon Music'
        OperatingSystemName                  : 'Android'
        DeviceClass                          : 'Phone'
  # Unknown Android device
  - test:
      input:
        user_agent_string: 'AmazonMusic/16.17.3 Dalvik/2.1.0 (Linux; U; Android 8.0.0; F5321 Build/34.4.A.2.118)'
      expected:
        AgentName                            : 'Amazon Music'
        OperatingSystemName                  : 'Android'
        DeviceClass                          : 'Mobile'


  # ---- Override of rules from Watches.yaml to give Device Type "Smart Watch" as that's the device type that we detect in cortex custom rules
  - matcher:
      require:
        - 'agent.(1)product.(1)comments.entry~"watch"'
      extract:
        - 'DeviceClass                         :   2001 :"Smart Watch"'

  - test:
      input:
        user_agent_string: 'AndroidDownloadManager/9 (Linux; U; Android 9; TicWatch Pro 4G Build/PWDD.190617.032)'
      expected:
        DeviceClass                          : 'Smart Watch'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Generic Android App'

  - test:
      input:
        user_agent_string: 'Overcast (+http://overcast.fm/; Apple Watch podcast app)'
      expected:
        DeviceClass                          : 'Smart Watch'
        OperatingSystemName                  : 'Cloud'
        AgentName                            : 'Overcast'

  - matcher:
      require:
        - 'agent.product.(1)name="SmartWatch"^.(1)comments.(2)entry.text'
      extract:
        - 'DeviceClass                         :   1101 :"Smart Watch"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.2; SM-N7505 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36 SmartWatch(Sony;SW2;660x800)'
      expected:
        DeviceClass                          : 'Smart Watch'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Chrome Webview'

  # ---- AntennaPod Android app
  - set:
      name: 'AntennaPodNames'
      values:
        - 'AntennaPod'
        - 'de.danoeh.antennapod'
        - 'de.danoeh.antennapod_mh'

  - matcher:
      require:
        - 'agent.product.name?AntennaPodNames'
      extract:
        - 'AgentName:            100: "AntennaPod"'
        - 'OperatingSystemName:  100: "Android"'
        - 'DeviceClass:          100: "Mobile"'

  - test:
      input:
        user_agent_string: 'de.danoeh.antennapod_mh/1.8.1 (Linux;Android 7.0) ExoPlayerLib/2.10.8'
      expected:
        AgentName: 'AntennaPod'
        OperatingSystemName: 'Android'
        DeviceClass: 'Mobile'
  - test:
      input:
        user_agent_string: 'de.danoeh.antennapod/1.8.1 (Linux;Android 9) ExoPlayerLib/2.10.8'
      expected:
        AgentName: 'AntennaPod'
        OperatingSystemName: 'Android'
        DeviceClass: 'Mobile'
  - test:
      input:
        user_agent_string: 'AntennaPod/1.81'
      expected:
        AgentName: 'AntennaPod'
        OperatingSystemName: 'Android'
        DeviceClass: 'Mobile'

  # ----- Gooole Podcasts iOS app matching
  # It has UserAgent very similar to Apple Podcasts iOS app.
  # ^Podcasts$ is Google Podcasts @ iOS (phones, tablets)
  # ^Podcasts/.* is Apple Podcasts

  - matcher:
      require:
        - 'agent.(1)text="Podcasts"'
        - 'IsNull[agent.(1)text^>]'
      extract:
        - 'AgentName:            100: "Google Podcasts"'
        - 'OperatingSystemName:  100: "iOS"'
        - 'DeviceClass:          100: "Mobile"'

  - test:
      input:
        user_agent_string: 'Podcasts'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Google Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcasts/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'

  # ---- JioSaavn matching

  - matcher:
      require:
        - 'agent.(1)product.(1)name="com.jio.media.jiobeats.jiosaavn"'
      extract:
        - 'AgentName                        : 1000: "JioSaavn"'
        - 'DeviceClass                      : 1000: "Mobile"'
        - 'OperatingSystemName              : 1000: "Android"'
  - test:
      input:
        user_agent_string: 'com.jio.media.jiobeats.jiosaavn/6.9.1 (Linux;Android 9) ExoPlayerLib/2.10.4'
      expected:
        AgentName: 'JioSaavn'
        DeviceClass: 'Mobile'
        OperatingSystemName: 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="com.jio.media.jiobeats"'
      extract:
        - 'AgentName                        : 1000: "JioSaavn"'
        - 'DeviceClass                      : 1000: "Mobile"'
        - 'OperatingSystemName              : 1000: "Android"'
  - test:
      input:
        user_agent_string: 'com.jio.media.jiobeats/6.9.1 (Linux;Android 5.1.1) ExoPlayerLib/2.10.4'
      expected:
        AgentName: 'JioSaavn'
        DeviceClass: 'Mobile'
        OperatingSystemName: 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="com.saavn.android"'
      extract:
        - 'AgentName                        : 1000: "JioSaavn"'
        - 'DeviceClass                      : 1000: "Mobile"'
        - 'OperatingSystemName              : 1000: "Android"'
  - test:
      input:
        user_agent_string: 'com.saavn.android/5.18.3 (Linux;Android 10) ExoPlayerLib/2.4.0'
      expected:
        AgentName: 'JioSaavn'
        DeviceClass: 'Mobile'
        OperatingSystemName: 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Saavn"'
      extract:
        - 'AgentName                        : 1000: "JioSaavn"'
        - 'DeviceClass                      : 1000: "Mobile"'
        - 'OperatingSystemName              : 1000: "iOS"'
  - test:
      input:
        user_agent_string: 'Saavn/650.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        AgentName: 'JioSaavn'
        DeviceClass: 'Mobile'
        OperatingSystemName: 'iOS'

  # ---- extended Apple Podcasts detection
  # based on https://podnews.net/article/podcast-app-useragents

  - set:
      name: 'ApplePodcastsNames'
      values:
        - Podcasts
        - Balados
        - Podcasti
        - Podcastit
        - Podcasturi
        - Podcasty
        - Podcast’ler
        - Podkaster
        - Podcaster
        - Podcast
        - Подкасти
        - Подкасты
        - पॉडकास्ट
        - พ็อดคาสท์
        - 播客
        - 팟캐스트
        - פודקאסטים
        - البودكاست

  # When UA starts with one od the names (followed by /) it's Apple Podcasts app on iOS
  - matcher:
      require:
        - 'agent.(1)product.(1)name?ApplePodcastsNames'
      extract:
        - 'AgentName:            100: "Apple Podcasts"'
        - 'OperatingSystemName:  100: "iOS"'
        - 'DeviceClass:          100: "Mobile"'


  # And when in addition there is (xxxx) in it it's Apple Podcasts app on Mac OS
  - matcher:
      require:
        - 'agent.(1)product.(1)name?ApplePodcastsNames'
        - 'agent.product.comments~"("'
        - 'agent.product.comments~")"'
      extract:
        - 'AgentName:            100: "Apple Podcasts"'
        - 'OperatingSystemName:  101: "Mac OS"'
        - 'DeviceClass:          101: "Desktop"'

  - test:
      input:
        user_agent_string: 'Podcasts/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Balados/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcasti/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcastit/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcasturi/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcasty/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcast’ler/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podkaster/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcaster/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Podcast/1420.34 CFNetwork/1120 Darwin/19.0.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Подкасти/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'Подкасты/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'פודקאסטים/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'البودكاست/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'พ็อดคาสท์/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: '팟캐스트/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: '播客/1425.5 CFNetwork/1121.1.2 Darwin/19.2.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'
  - test:
      input:
        user_agent_string: 'पॉडकास्ट/1425.5 CFNetwork/1121.2 Darwin/19.3.0 (x86_64)'
      expected:
        DeviceClass: 'Desktop'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'Mac OS'

  - test:
      input:
        user_agent_string: 'Podcasts/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Balados/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcasti/1410.25.1 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcastit/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcasturi/1410.25.1 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcasty/1410.25.1 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcast’ler/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podkaster/1420.35 CFNetwork/1120 Darwin/19.0.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcaster/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Podcast/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Подкасти/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'Подкасты/1410.25.1 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'פודקאסטים/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'البودكاست/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'พ็อดคาสท์/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: '팟캐스트/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: '播客/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'
  - test:
      input:
        user_agent_string: 'पॉडकास्ट/1425.5 CFNetwork/1121.2.2 Darwin/19.2.0'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Apple Podcasts'
        OperatingSystemName: 'iOS'

  # ---- special rules for Sky News iOS and Sky New Android
  - test:
      input:
        user_agent_string: 'Sky News iOS/1.0 (iOS 12.4.4; en_GB)'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Sky News iOS'
        OperatingSystemName: 'iOS'

  - test:
      input:
        user_agent_string: 'Sky News Android/1.0 (Android 9; en_GB)'
      expected:
        DeviceClass: 'Mobile'
        AgentName: 'Sky News Android'
        OperatingSystemName: 'Android'



  # -----------
  # Fallback iOS detection - if OS is Unknown and iOS present it's an iOS
  - matcher:
      require:
        - 'agent~"iOS/"'
      extract:
        - 'DeviceClass: 1: "Mobile"'
        - 'OperatingSystemName: 1: "iOS"'

  - matcher:
      require:
        - 'agent~"iOS "'
      extract:
        - 'DeviceClass: 1: "Mobile"'
        - 'OperatingSystemName: 1: "iOS"'

  # -----------
  # Fallback iPod/iPhone detection - when present, it's iOS Phone
  # Fallback iPad detection - when iPad present, it's iOS Tablet. (iPad has higher weight than iPhone/iPod cause when both are present it's more probably an iPad)
  - matcher:
      require:
        - 'agent~"(iPad"'
      extract:
        - 'DeviceClass: 3: "Tablet"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"/iPad"'
      extract:
        - 'DeviceClass: 3: "Tablet"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"-iPad"'
      extract:
        - 'DeviceClass: 3: "Tablet"'
        - 'OperatingSystemName: 1: "iOS"'

  - matcher:
      require:
        - 'agent~"/iPod"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"(iPod"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"-iPod"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'

  - matcher:
      require:
        - 'agent~"(iPhone"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"/iPhone"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'
  - matcher:
      require:
        - 'agent~"-iPhone"'
      extract:
        - 'DeviceClass: 2: "Phone"'
        - 'OperatingSystemName: 1: "iOS"'

  - test:
      input:
        user_agent_string: 'Spotify/8.4.51 iOS/9.3.5 (iPad3,1)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'Spotify'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'RSSRadio/9252 (iPad;iOS;12.4.1)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'RSSRadio'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'com.evolve.podcast/3.3.1 (iPad; ) (build 857, iOS 13.2.3)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'com.evolve.podcast'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'itunesstored/1.0 iOS/10.1.1 model/iPad3,4 hwp/s5l8955x build/14B100 (5; dt:83)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'iOS'

  # -----------
  # Fallback Android detection - if OS is Unknown and Android present it's an Android
  - matcher:
      require:
        - 'agent~"Android"'
        - 'IsNull[agent~"like Android"]'
        - 'IsNull[agent~"Windows"]'
      extract:
        - 'DeviceClass: 1: "Mobile"'
        - 'OperatingSystemName: 1: "Android"'

  # ----------
  # LG Player detection
  - matcher:
      require:
        - 'agent.product.version="LG Player"'
      extract:
        - 'AgentName: 6: "LG Player"'

  - test:
      input:
        user_agent_string: 'LG-D618/V20a Player/LG Player 1.0 for Android 5.0.2 (stagefright alternative)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'LG Player'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Player/LG Player 1.0 for Android 4.4.2 (stagefright alternative)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'LG Player'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Podimo/1.10.1 build 83/Android 26'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Podimo'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: '##_SM-A102U_Extended Network_9_blenderandroid_en_0.16.0_DID999'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : '##_SM-A102U_Extended'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'RadioPublic/android-2.2'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'RadioPublic'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'TCL-5054S-SVN/010 01; stagefright/1.2 (Linux;Android 5.1.1)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  # ------------------------------------------------------------------------------------------------------------------------------
  # We want IE Mobile to be tagged as Internet Explorer
  - matcher:
      require:
        - 'agent.product.comments.entry.product.name="IEMobile"'
      extract:
        - 'AgentName: 2012: "Internet Explorer"'

  - test:
      input:
        user_agent_string: 'HTC_Touch_Pro2_T7373 Mozilla/4.0 (compatible; MSIE 6.0; Windows CE; IEMobile 8.12; MSIEMobile 6.0)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Internet Explorer'
        OperatingSystemName                    : 'Windows CE'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Mobile; Windows Phone 8.1; Android 4.0; ARM; Trident/7.0; Touch; rv:11.0; IEMobile/11.0; NOKIA; Lumia 930; Vodafone) like iPhone OS 7_0_3 Mac OS X AppleWebKit/537 (KHTML, like Gecko) Mobile Safari/537'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Internet Explorer'
        OperatingSystemName                    : 'Windows Phone'

  # ------------------------------------------------------------------------------------------------------------------------------
  # Android media player ExoPlayer provides an example how it can be used with yourApplicationName as a sample user agent,
  # so all traffic with yourApplicationName seems to be using this example
  # https://www.programcreek.com/java-api-examples/?class=com.google.android.exoplayer2.util.Util&method=getUserAgent

  - matcher:
      require:
        - 'agent.(1)product.(1)name="yourApplicationName"'
      extract:
        - 'AgentName                         :    201 :"Generic Android App"'

  - test:
      input:
        user_agent_string: 'yourApplicationName/2.17.64 (Linux;Android 9) ExoPlayerLib/2.10.8'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  # ------------------------------------------------------------------------------------------------------------------------------

  # Known apps lookup
  - matcher:
      extract:
        - 'AgentName                         :    200 :LookUp[KnownApplications;agent.product.name]'

  #### special rules for known apps special cases
  # Zune can be in product or in comments
  - matcher:
      require:
        - 'agent.product.comments.entry.product.name="Zune"'
      extract:
        - 'AgentName                         :    2020: "Zune"'

  # MediaGo doesn't have a product fragment
  - matcher:
      require:
        - 'agent.text="MediaGo"'
      extract:
        - 'AgentName                         :    2020: "MediaGo"'

  # bPod doesn't have a product fragment
  - matcher:
      require:
        - 'agent.text="bPod"'
      extract:
        - 'AgentName                        : 2020: "Blackberry"'
        - 'DeviceClass                      : 2000: "Phone"'
        - 'OperatingSystemName              : 2000: "Blackberry"'

  # FFmpegMediaPlayer doesn't have a product fragment
  - matcher:
      require:
        - 'agent.text="FFmpegMediaPlayer"'
      extract:
        - 'AgentName                        : 2020: "FFmpeg"'
        - 'DeviceClass                      : 2000: "Unknown"'
        - 'OperatingSystemName              : 2000: "Unknown"'

  # Podcast Addict - Dalvik - dash is taken as version separator, so it's not seen as part of product name
  - matcher:
      require:
        - 'agent.product{"Podcast Addict - Dalvik/"'
      extract:
        - 'AgentName                        : 2000: "PodcastAddict"'

  # MediaAnalyzer/podCloud - slash is taken as version separator, so it's not seen as part of product name
  - matcher:
      require:
        - 'agent.product{"MediaAnalyzer/podCloud"'
      extract:
        - 'AgentName                        : 2000: "podCloud"'

  # Nullsoft Winamp3
  - matcher:
      require:
        - 'agent.product{"Nullsoft Winamp3"'
      extract:
        - 'AgentName                        : 2000: "Winamp"'

  # MixcloudPodcastImporter is a robot
  - matcher:
      require:
        - 'agent.product.name="MixcloudPodcastImporter"'
      extract:
        - 'DeviceClass                        : 200: "Robot"'

  # iCatcher can be anywhere
  - matcher:
      require:
        - 'agent~"iCatcher!"'
      extract:
        - 'AgentName                        : 201: "iCatcher"'

  - lookup:
      name: 'KnownApplications'
      map:
        "NSPlayer"                      : "Windows Media Player"
        "Windows-Media-Player"          : "Windows Media Player"
        "Audacious"                     : "Audacious"
        "iTunes"                        : "iTunes"
        "iTunes-iPhone"                 : "iTunes"
        "iTunes-iPod"                   : "iTunes"
        "iTunes-iPad-M"                 : "iTunes"
        "iTunes-iPad"                   : "iTunes"
        "LibVLC"                        : "VLC"
        "vlc"                           : "VLC"
        "VLC media player - version"    : "VLC"
        "Ares"                          : "Ares"
        "Overcast"                      : "Overcast"
        "Zune"                          : "Zune"
        "Stitcher"                      : "Stitcher"
        "stitcherbot"                   : "Stitcher"
        "gPodder"                       : "gPodder"
        "Podkicker"                     : "Podkicker"
        "Instacast"                     : "Instacast"
        "Ivoox"                         : "iVoox"
        "Sonos"                         : "Sonos"
        "CORE"                          : "Generic Android App"
        "Dalvik"                        : "Generic Android App"
        "AndroidDownloadManager"        : "Generic Android App"
        "AntennaPod"                    : "AntennaPod"
        "PodCruncher"                   : "PodCruncher"
        "Radioline"                     : "Radioline"
        "Acast"                         : "Acast"
        "APKXDL"                        : "Generic Android App"
        "Audioteka"                     : "Audioteka"
        "Castamatic"                    : "Castamatic"
        "CastBox"                       : "CastBox"
        "Castro"                        : "Castro"
        "Clementine"                    : "Clementine"
        "Downcast"                      : "Downcast"
        "EMAudioPlayer"                 : "Generic Android App"
        "ExoPlayerDemo"                 : "Generic Android App"
        "ExoPlayerWrapper"              : "Generic Android App"
        "HTC Streaming Player htc"      : "HTC Music"
        "iHeartRadio"                   : "iHeartRadio"
        "itunesstored"                  : "iTunes"
        "MediaMonkey"                   : "MediaMonkey"
        "Mixcloud"                      : "Mixcloud"
        "MixcloudPodcastImporter"       : "Mixcloud"
        "Podbean"                       : "Podbean"
        "PodcastAddict"                 : "PodcastAddict"
        "Podkicker Classic"             : "Podkicker"
        "Podkicker Pro"                 : "Podkicker"
        "RSSRadio"                      : "RSSRadio"
        "Spotify"                       : "Spotify"
        "StitcherBot"                   : "Stitcher"
        "Trunews"                       : "Trunews"
        "UCast"                         : "UCast"
        "VLC"                           : "VLC"
        "WeCast"                        : "WeCast"
        "WinampMPEG"                    : "Winamp"
        "Winamp"                        : "Winamp"
        "Winamp3"                       : "Winamp"
        "ivooxNew"                      : "iVoox"
        "Roku"                          : "Roku"
        "WMPlayer"                      : "Windows Media Player"
        "Ask Pastor John"               : "Ask Pastor John"
        "The Karel Cast"                : "The Karel Cast"
        "GLOBAL HITS CON ARMANDO PLATA" : "GLOBAL HITS con Armando Plata"
        "Headgum"                       : "Headgum"
        "iDownloaderPro"                : "iDownloaderPro"
        "MPlayer"                       : "MPlayer"
        "Simple Radio"                  : "Simple Radio"
        "TuneIn Radio Pro"              : "TuneIn Radio"
        "TuneIn Radio"                  : "TuneIn Radio"
        "Juice"                         : "Juice"
        "mytuner_podcasts_androidplayer" : "myTuner"
        "RMA"                           : "RealPlayer"
        "Deezer"                        : "Deezer"
        "Pandora"                       : "Pandora"
        "Luminary"                      : "Luminary"

  - test:
      input:
        user_agent_string: 'Deezer/6.1.15.86 (Android; 9; Mobile; mx) samsung SM-A105M'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Deezer'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'NSPlayer/11.0.5721.5145 WMFSDK/11.0'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'Windows Media Player'
        OperatingSystemName                    : 'Windows'

  - test:
      input:
        user_agent_string: 'Windows-Media-Player/12.0.7600.16667'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Windows Media Player'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Audacious/3.10.1 neon/0.30.2'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Audacious'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'iTunes/4.7.1 (Unix; N; linux; x86_64-linux; EN; utf8) SqueezeNetwork/7.7.7-sn/TRUNK'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'Linux'

  - test:
      input:
        user_agent_string: 'iTunes/12.9.5 (Macintosh; OS X 10.14.5) AppleWebKit/607.2.6.1.1 (dt:1)'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'Mac OS'

  - test:
      input:
        user_agent_string: 'iTunes/12.10.2 (Windows; Microsoft Windows Server 2016 x64 Datacenter Edition (Build 14393); x64) AppleWebKit/7608.3010.1004.4'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes-iPod/5.1.1 (3; 32GB; dt:25)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'iTunes-iPad-M/5.1.1 (64GB; dt:28)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'iTunes-iPhone/4.2.1 (4; 32GB)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'LibVLC/2.0.1 (Linux; U; Android 9;greatlte/PPR1.180610.011)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'VLC'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'VLC/2.2.0-git LibVLC/2.2.0-git (Radioline)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'VLC'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'vlc/1.1.4 LibVLC/1.1.4'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'VLC'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'VLC media player - version 1.0.5 Goldeneye - (c) 1996-2010 the VideoLAN team'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'VLC'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Ares 2.1.7.3041'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Ares'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Overcast/3.0 (+http://overcast.fm/; iOS podcast app)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Overcast'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'Zune/4.8'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Zune'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Zune 4.0; Tablet PC 2.0; InfoPath.3; .NET4.0C; .NET4.0E)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'Zune'
        OperatingSystemName                    : 'Windows NT'

  - test:
      input:
        user_agent_string: 'Stitcher/iOS'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Stitcher'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'StitcherBot (MP3 Search Bot for Stitcher Personalized Radio Service)'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Stitcher'
        OperatingSystemName                    : 'Cloud'

  - test:
      input:
        user_agent_string: 'MediaGo'
      expected:
        DeviceClass                            : 'Hacker'
        AgentName                              : 'MediaGo'
        OperatingSystemName                    : 'Hacker'

  - test:
      input:
        user_agent_string: 'gPodder/3.10.5 (+http://gpodder.org/) Linux/4.19.82-gentoo'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'gPodder'
        OperatingSystemName                    : 'Linux'

  - test:
      input:
        user_agent_string: 'Podkicker/3.0.0'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Podkicker'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Instacast/2621 CFNetwork/811.5.4 Darwin/16.6.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Instacast'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Ivoox 2.9.2 (iPod touch; iPhone OS 6.1.6; es_VE)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iVoox'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'Linux UPnP/1.0 Sonos/53.2-70100 (ZPS22)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Sonos'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'CORE/6.506.4.1 OpenCORE/2.02 (Linux;Android 2.2.1)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Dalvik/2.1.0 (Linux; U; Android 8.1.0; SNE-LX1 Build/HUAWEISNE-LX1)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'AndroidDownloadManager/9 (Linux; U; Android 9; SM-G975U Build/PPR1.180610.011)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  #  there is a special rule for AntennaPod defining also device class and os
  - test:
      input:
        user_agent_string: 'AntennaPod/1.7.3'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'AntennaPod'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'iCatcher!/6.1.1 (iPhone; iOS 13.1.2; Scale/3.0)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iCatcher'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'iCatcher! podcast app/2.2.6'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'iCatcher'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'iTunes (iCatcher!/2.8.7)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'iCatcher'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'PodCruncher/3.7.1 CFNetwork/889.9 Darwin/17.2.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'PodCruncher'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Radioline 2/5.8.4 CFNetwork/978.0.7 Darwin/18.7.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Radioline'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Acast/2.6.0 (Phone; iOS 12.4.1; iPhone8,1)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Acast'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'APKXDL (Linux; U; Android 8.0.0;de; hero2lte/R16NW) Downloader'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Audioteka/423 CFNetwork/902.2 Darwin/17.7.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Audioteka'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'bPod'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Blackberry'
        OperatingSystemName                    : 'Blackberry'

  - test:
      input:
        user_agent_string: 'Castamatic/3084 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Castamatic'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'CastBox/5.10.3-191018042.rfd6f0bb (Linux;Android 7.0)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'CastBox'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Castro 2019.8/1150'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Castro'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Clementine 1.3.1-390-g9a5bcb7a3'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Clementine'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Downcast/2.9.32 (iPod touch; iOS 11.0.3; Scale/2.00)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Downcast'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'EMAudioPlayer 2.9.1 (655) / Android 4.4.2 / X9006'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'ExoPlayerDemo/1.0 (Linux;Android 7.1.2) ExoPlayerLib/1.5.4'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'ExoPlayerWrapper/4.2.12 (Linux;Android 9) ExoPlayerLib/2.4.3'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'FFmpegMediaPlayer'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'FFmpeg'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'HTC Streaming Player htc / 1.0 / htc_asia_wwe / 4.2.2'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'HTC Music'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'iHeartRadio/8.16.1 (Android 5.1.1; SM-T900 Build/LMY47X)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iHeartRadio'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'itunesstored/1.0 iOS/9.2 model/iPhone8,2 hwp/s8003 build/13C75 (6; dt:142)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iTunes'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'MediaMonkey 4.1.11.1783'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'MediaMonkey'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Mixcloud/20.2.4 (Linux;Android 8.1.0) ExoPlayerLib/2.8.1'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Mixcloud'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'MixcloudPodcastImporter/2.0'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Mixcloud'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Podbean/Android App 7.4.7 (http://podbean.com),2b9f3bee5269557c63df05e127440a37'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Podbean'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Podcast Addict - Dalvik/2.1.0 (Linux; U; Android 10; ONEPLUS A6000 Build/QKQ1.190716.003)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'PodcastAddict'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'PodcastAddict/v2 - Dalvik/2.1.0 (Linux; U; Android 9; COL-L29 Build/HUAWEICOL-L29)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'PodcastAddict'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Podkicker Classic/1.2.9'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Podkicker'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Podkicker Pro/3.0.2'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Podkicker'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'RSSRadio/9418 (iPad;iOS;12.4.3)'
      expected:
        DeviceClass                            : 'Tablet'
        AgentName                              : 'RSSRadio'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'Spotify/8.5.33 Android/23 (SAMSUNG-SM-G900A) Dynamo/1.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Spotify'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'StitcherBot (MP3 Search Bot for Stitcher Personalized Radio Service)'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Stitcher'
        OperatingSystemName                    : 'Cloud'

  - test:
      input:
        user_agent_string: 'Trunews/1.191.333.723.28 CFNetwork/901.1 Darwin/17.6.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Trunews'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'UCast/1.0 Podcast Sync (1 subscribers; feed-id=aHR0cHM6Ly93d3cuc3ByZWFrZXIuY29tL3Nob3cvMzMwOTIxNC9lcGlzb2Rlcy9mZWVk5AE3C22E-DCB8-47F9-B924-8ED3F02792F9; +http://www.ucastapp.com/)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'UCast'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'WeCast/4.39 CFNetwork/672.1.15 Darwin/14.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'WeCast'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'WinampMPEG/5.50'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Winamp'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'WinampMPEG/5.58, Ultravox/2.1'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Winamp'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Nullsoft Winamp3 version 3.0 (compatible)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Winamp'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'ivooxNew/6 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'iVoox'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Roku/DVP-7.53 (077.53E04110A)'
      expected:
        DeviceClass                            : 'TV'
        AgentName                              : 'Roku'
        OperatingSystemName                    : 'Roku OS'

  - test:
      input:
        user_agent_string: 'WMPlayer/10.0.0.364 guid/3300AD50-2C39-46C0-AE0A-AC7B8159E203'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'Windows Media Player'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Ask Pastor John/464 CFNetwork/1098.7 Darwin/19.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Ask Pastor John'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'The Karel Cast /1.50.52.181.23 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'The Karel Cast'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'GLOBAL HITS CON ARMANDO PLATA/1 CFNetwork/978.0.7 Darwin/18.7.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'GLOBAL HITS con Armando Plata'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Headgum/3 CFNetwork/978.0.7 Darwin/18.6.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Headgum'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'iDownloaderPro/1.0.1 CFNetwork/609.1.4 Darwin/13.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'iDownloaderPro'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'MPlayer 1.3.0 (Debian), built with gcc-6.2.1'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'MPlayer'
        OperatingSystemName                    : 'Debian'

  - test:
      input:
        user_agent_string: 'Simple Radio/1258 CFNetwork/758.5.3 Darwin/15.6.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Simple Radio'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'TuneIn Radio Pro/1224 CFNetwork/978.0.7 Darwin/18.7.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'TuneIn Radio'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'TuneIn Radio/1105 CFNetwork/758.5.3 Darwin/15.6.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'TuneIn Radio'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Juice/2.22 (Windows) +http://juicereceiver.sf.net/'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'Juice'
        OperatingSystemName                    : 'Windows'

  - test:
      input:
        user_agent_string: 'mytuner_podcasts_androidplayer/1.0.2 (Linux;Android 9) ExoPlayerLib/2.8.4'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'myTuner'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'MediaAnalyzer/podCloud 1.1 (like iTunes/10.0)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'podCloud'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'RMA/1.0 (compatible; RealMedia)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'RealPlayer'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 Pandora/1911.2 Dynamo/1.0'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Pandora'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'Pandora/1910.3 Android/9 mh4x (ExoPlayerLib1.5.14.1)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Pandora'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Luminary/2.0 (Android 9; POT-LX1; HUAWEI HWPOT-H; en)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Luminary'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Luminary/5.1 build 123/iOS 13.1.3'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Luminary'
        OperatingSystemName                    : 'iOS'

  # ------------------------------------------------------------------------------------------------------------------------------
  # Known media libraries lookup
  - matcher:
      extract:
        - 'AgentName                         :    200 :LookUp[KnownMediaLibraries;agent.product.name]'

  #### special rules for known media libs special cases

  # okhttp-okgo does not extract okhttp as a product name
  - matcher:
      require:
        - 'agent.product.name~"okhttp"'
      extract:
        - 'AgentName                         :    2020: "Generic Android App"'
        - 'DeviceClass                       :    200:  "Robot"'

  # BeyondPod is in comments and it's an Android app
  - matcher:
      require:
        - 'agent.product.comments~"BeyondPod"'
      extract:
        - 'AgentName                         :    2000: "BeyondPod"'
        - 'OperatingSystemName:                   2001: "Android"'
        - 'DeviceClass:                           2001: "Mobile"'

  # DoggCatcher is in comments
  - matcher:
      require:
        - 'agent.text~"DoggCatcher"'
      extract:
        - 'AgentName                         :    2000: "DoggCatcher"'
        - 'DeviceClass:                           2000: "Mobile"'
        - 'OperatingSystemName:                   2001: "Android"'

  # Facebook attribute in comments
  - matcher:
      require:
        - 'agent.product.comments~"FBAV"'
      extract:
        - 'AgentName                         :    10001: "Facebook"'

  # Kodi needs higher weight as otherwise it's overweighted by SpecialBrowsers rule
  - matcher:
      require:
        - 'agent.product.name="Kodi"'
      extract:
        - 'AgentName                         :    2020: "Kodi Media Center"'

  # GStreamer can be anywhere
  - matcher:
      require:
        - 'agent~"GStreamer"'
      extract:
        - 'AgentName                         :    2020: "GStreamer"'

  # NexPlayer can be anywhere
  - matcher:
      require:
        - 'agent~"NexPlayer"'
      extract:
        - 'AgentName                         :    2020: "NexPlayer"'

  # VictorReader is just a part of product name
  - matcher:
      require:
        - 'agent.product.name~"VictorReader"'
      extract:
        - 'AgentName                         :    2020: "VictorReader"'

  - lookup:
      name: 'KnownMediaLibraries'
      map:
        "stagefright"               : "Generic Android App"
        "okhttp"                    : "Generic Android App"
        "DoggCatcher"               : "DoggCatcher"
        "FBAV"  : "Facebook"
        "Kodi"                      : "Kodi Media Center"
        "XBMC"                      : "Kodi Media Center" # This is the former name of Kodi
        "QuickTime"                 : "QuickTime"
        "Player FM"                 : "Player FM"
        "MSIE"                      : "Internet Explorer"
        "CrKey"                     : "Chromecast"

  - test:
      input:
        user_agent_string: 'stagefright/1.2 (Linux;Android 4.1.2)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Samsung SM-G920I stagefright/Beyonce/1.1.9 (Linux;Android 7.0)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'okhttp/3.12.1'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'okhttp-okgo/jeasonlzy'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Generic Android App'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; U; en-us; BeyondPod 4) Dynamo/1.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'BeyondPod'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; U; Windows NT 6.1; en-us; dream) DoggCatcher'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'DoggCatcher'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 5.1; 8050E Build/LMY47I; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/78.0.3904.62 Mobile Safari/537.36 [FB_IAB/FB4A;FBAV/244.0.0.43.118;]'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Facebook'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 13_1_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 [FBAN/FBIOS;FBAV/207.0.0.48.100;FBBV/141048683;FBDV/iPhone10,5;FBMD/iPhone;FBSN/iOS;FBSV/13.1.2;FBSS/3;FBCR/AT&T;FBID/phone;FBLC/en_US;FBOP/5;FBRV/142061404]'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Facebook'
        OperatingSystemName                    : 'iOS'

  - test:
      input:
        user_agent_string: 'Kodi/17.5 (Windows NT 6.1; WOW64) App_Bitness/32 Version/17.5-Git:20171023-5bd45ab'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'Kodi Media Center'
        OperatingSystemName                    : 'Windows NT'

  - test:
      input:
        user_agent_string: 'XBMC/13.2 Git:20140817-0f3db05 (Windows NT 6.0; http://xbmc.org)'
      expected:
        DeviceClass                            : 'Robot'
        AgentName                              : 'Kodi Media Center'
        OperatingSystemName                    : 'Cloud'

  - test:
      input:
        user_agent_string: 'QuickTime/7.7 (qtver=7.7;cpu=IA32;os=Mac 10.5.8)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'QuickTime'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Player FM/459 CFNetwork/1107.1 Darwin/19.0.0'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'Player FM'
        OperatingSystemName                    : 'Darwin (iOS)'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (compatible; MSIE 7.0; Windows NT 5.0; Trident/4.0;'
      expected:
        DeviceClass                            : 'Desktop'
        AgentName                              : 'Internet Explorer'
        OperatingSystemName                    : 'Windows NT'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Windows Phone 8.1; ARM; Trident/7.0; Touch; rv:11.0; IEMobile/11.0; NOKIA; Lumia 625) like Gecko'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'Internet Explorer'
        OperatingSystemName                    : 'Windows Phone'

  - test:
      input:
        user_agent_string: 'amarok/2.9.0 (Phonon/4.8.3; Phonon-GStreamer/4.9.0)'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'GStreamer'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'GStreamer souphttpsrc libsoup/2.42.2'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'GStreamer'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'GStreamer neonhttpsrc'
      expected:
        DeviceClass                            : 'Hacker'
        AgentName                              : 'GStreamer'
        OperatingSystemName                    : 'Hacker'

  - test:
      input:
        user_agent_string: 'HbbTV/1.2.1 (+PVR+DRM; Arcelik; MWB;;;) GStreamer neonhttpsrc'
      expected:
        DeviceClass                            : 'TV'
        AgentName                              : 'GStreamer'
        OperatingSystemName                    : 'Proprietary'

  - test:
      input:
        user_agent_string: 'stagefright/1.2 (Linux;Android NexPlayer LG-P708g20a-TCL-XX)'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'NexPlayer'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'NexPlayer 4.0 for Android( stagefright alternative )'
      expected:
        DeviceClass                            : 'Mobile'
        AgentName                              : 'NexPlayer'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'VictorReader Stream Trek uk-en Graham Rachel 1.2.11'
      expected:
        DeviceClass                            : 'Unknown'
        AgentName                              : 'VictorReader'
        OperatingSystemName                    : 'Unknown'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (X11; Linux armv7l) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.81 Safari/537.36 CrKey/1.42.180518 Dynamo/1.0'
      expected:
        DeviceClass                            : 'TV'
        AgentName                              : 'Chromecast'
        OperatingSystemName                    : 'Linux'

  # ------------------------------------------------------------------------------------------------------------------------------

  - set:
      name: 'Bots'
      values:
        - 'Go-http-client'
        - 'IMGStreamchecker'
        - 'fyyd-poll'
        - 'Apache-HttpClient'
        - 'Python-urllib'

  - set:
      name: 'AppleTV'
      values:
        - 'Apple TV'
        - 'AppleTV'
        - 'Apple tv'

  - set:
      name: 'LibsynBots'
      values:
        - 'Libsyn4-Download'
        - 'Libsyn4-peek'
        - 'Libsyn4Peek'
        - 'Libsyn4-Peek'
        - 'Libsyn3'

  # iHeartRadio Apps
  - matcher:
      require:
        - 'agent.(1)product.(1)name="iHeartRadio"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name{"Android"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 : agent.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'iHeartRadio/7.5.1 (Android Sdk 24)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iHeartRadio'
        OperatingSystemName                    : 'Android'

  - test:
      input:
        user_agent_string: 'iHeartRadio/8.10.0 (Android 7.1.1; ZTE B2017G Build/NMF26V)'
      expected:
        DeviceClass                            : 'Phone'
        AgentName                              : 'iHeartRadio'
        OperatingSystemName                    : 'Android'

    # Smart Speakers
  - matcher:
      require:
        - 'agent.product.name="AlexaMediaPlayer"'
      extract:
        - 'DeviceClass                         :   2000 : "Smart Speaker"'
        - 'OperatingSystemName                 :   1000 : "Amazon Alexa"'
        - 'AgentName                           :   1000 : "Alexa Media Player"'

  - matcher:
      require:
        - 'agent.product.name="AlexaMediaPlayer"'
        - 'agent.(1)product.(1)version="Stitcher"'
      extract:
        - 'DeviceClass                         :   2000 : "Smart Speaker"'
        - 'OperatingSystemName                 :   1000 : "Amazon Alexa"'
        - 'AgentName                           :   1001 : "Stitcher"'

  - test:
      input:
        user_agent_string: 'AlexaMediaPlayer/1.0.2353.0_16xxxxxx (Linux;Android 5.1.1) ExoPlayerLib/1.5.9'
      expected:
        DeviceClass                          : 'Smart Speaker'
        OperatingSystemName                  : 'Amazon Alexa'
        AgentName                            : 'Alexa Media Player'

  - test:
      input:
        user_agent_string: 'AlexaMediaPlayer/5.1.1-256.5.9.9_user_599xxxxxx (Linux;Android 5.1.1) ExoPlayerLib/1.5.9'
      expected:
        DeviceClass                          : 'Smart Speaker'
        OperatingSystemName                  : 'Amazon Alexa'
        AgentName                            : 'Alexa Media Player'

  - test:
      input:
        user_agent_string: 'AlexaMediaPlayer/Stitcher (Linux;Android 8.1.0) ExoPlayerLib/2.2.0'
      expected:
        DeviceClass                          : 'Smart Speaker'
        OperatingSystemName                  : 'Amazon Alexa'
        AgentName                            : 'Stitcher'

  - matcher:
      require:
        - 'agent.product.name="GoogleChirp"'
      extract:
        - 'DeviceClass                         :   1000 : "Smart Speaker"'
        - 'OperatingSystemName                 :   1000 : "Google Nest"'
        - 'AgentName                           :   1000 : "Google Podcasts"'

  - test:
      input:
        user_agent_string: 'Libassistant/1.0 GoogleChirp/1.0.1 (Linux; Android/5.0) GOOG/7 AppleWebKit/534.30 (KHTML, like Gecko)'
      expected:
        DeviceClass                          : 'Smart Speaker'
        OperatingSystemName                  : 'Google Nest'
        AgentName                            : 'Google Podcasts'

  - matcher:
      require:
        - 'agent.product.name="GSA"'
      extract:
        - 'AgentName                           :   10001 : "Google Podcasts"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 8.1.0; Pixel XL Build/OPM2.171019.029; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/65.0.3325.109 Mobile Safari/537.36 GSA/8.0.17.21.arm64'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Google Podcasts'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; U; Android 8.1.0; zh-cn; PBAT00 Build/OPM1.171019.026) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30 GSA/10.86.14.21.arm64'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Google Podcasts'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 12_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) GSA/87.0.279142407 Mobile/15E148 Safari/605.1'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Google Podcasts'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 13_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) GSA/87.0.279142407 Mobile/15E148 Safari/605.1'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Google Podcasts'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Echo"'
        - 'agent.(1)product.(1)comments="(APNG)"'
      extract:
        - 'DeviceClass                        :   2000 : "Smart Speaker"'
        - 'AgentName                          :   1000 : "Alexa Media Player"'
        - 'OperatingSystemName                :   1000 : "Amazon Alexa"'

  - test:
      input:
        user_agent_string                    : 'Echo/1.0(APNG)'
      expected:
        DeviceClass                          : 'Smart Speaker'
        AgentName                            : 'Alexa Media Player'
        OperatingSystemName                  : 'Amazon Alexa'

    # Smart Watch
  - matcher:
      require:
        - 'agent.(1)product.(1)name="AppleCoreMedia"'
        - 'agent.(1)product.(1)comments.(1)entry="Apple Watch"'
        - 'agent.(1)product.(1)comments.(3)entry.(2)text="like Mac OS X"'
      extract:
        - 'OperatingSystemName               :   2500 : "WatchOS"'
        - 'AgentName                         :   3500 : "Apple Podcasts"'
        - 'DeviceClass                       :   2500 : "Smart Watch"'

  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16U113 (Apple Watch; U; CPU OS 5_2_1 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'Smart Watch'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'WatchOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="atc"'
        - 'agent.(2)product.(1)name="watchOS"'
        - 'agent.(4)product.(1)name="hwp"'
      extract:
        - 'OperatingSystemName               :   2000 : "WatchOS"'
        - 'AgentName                         :   1000 : "Apple Podcasts"'
        - 'DeviceClass                       :   1000 : "Smart Watch"'

  - test:
      input:
        user_agent_string                    : 'atc/1.0 watchOS/5.1.3 model/Watch3,4 hwp/t8004 build/16S535 (6; dt:156)'
      expected:
        DeviceClass                          : 'Smart Watch'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'WatchOS'

  - test:
      input:
        user_agent_string                    : 'atc/1.0 watchOS/5.2 model/Watch4,4 hwp/t8006 build/16T225 (6; dt:193)'
      expected:
        DeviceClass                          : 'Smart Watch'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'WatchOS'

  - matcher:
      require:
        - 'agent.(1)product="Mozilla/5.0 (null)/(null)"'
        - 'agent.(2)product.(1)name="watchOS"'
        - 'agent.(4)product.(1)name="hwp"'
      extract:
        - 'OperatingSystemName               :   2000 : "WatchOS"'
        - 'AgentName                         :   1000 : "Apple Podcasts"'
        - 'DeviceClass                       :   1000 : "Smart Watch"'

  - test:
      input:
        user_agent_string                    :  '(null)/(null) watchOS/5.1.1 model/Watch3,3 hwp/t8004 build/16R600 (6; dt:155)'
      expected:
        DeviceClass                          : 'Smart Watch'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'WatchOS'

  # podcatchers
  - matcher:
      require:
        - 'agent.(1)product.(1)name="Stitcher"'
        - 'agent.(1)product.(1)version="Android"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 :  agent.(1)product.(1)version'
  - test:
      input:
        user_agent_string                    : 'Stitcher/Android'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Stitcher'
        OperatingSystemName                  : 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Stitcher"'
        - 'agent.(1)product.(1)version="iOS"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 :  agent.(1)product.(1)version'
  - test:
      input:
        user_agent_string                    : 'Stitcher/iOS'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Stitcher'
        OperatingSystemName                  : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Castbox"'
      extract:
        - 'AgentName                          :   1001 : "CastBox"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="CastBox"'
        - 'agent.(1)product.(1)comments.(3)entry.(1)product.(1)name="iOS"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 : agent.(1)product.(1)comments.(3)entry.(1)product.(1)name'

  - test:
      input:
        user_agent_string                    : 'CastBox/4.27 (fm.castbox.audiobook.radio.podcast; build:8; iOS 12.2.0)'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'CastBox'
        OperatingSystemName                  : 'iOS'

  - test:
      input:
        user_agent_string                    : 'Castbox/4.22.1 (fm.castbox.audiobook.radio.podcast; build:2; iOS 12.3.1) Alamofire/4.7.3'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'CastBox'
        OperatingSystemName                  : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Overcast"'
        - 'agent.(1)product.(1)comments.(1)entry="http://overcast.fm/"'
        - 'agent.(1)product.(1)comments.(2)entry="iOS podcast app"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 : "iOS"'

  - test:
      input:
        user_agent_string                    : 'Overcast/3.0 (+http://overcast.fm/; iOS podcast app)'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Overcast'
        OperatingSystemName                  : 'iOS'

  - test:
      input:
        user_agent_string                    : 'Overcast/2.0 (+http://overcast.fm/; iOS podcast app)'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Overcast'
        OperatingSystemName                  : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Luminary"'
        - 'agent.(2)product.(2)version="iOS"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 : agent.(2)product.(2)version'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Luminary"'
        - 'agent.(2)product.(2)version="Android"'
      extract:
        - 'DeviceClass                        :   2000 : "Mobile"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 : agent.(2)product.(2)version'

  - test:
      input:
        user_agent_string                    : 'Luminary/1.0.3 build 71/iOS 12.2'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Luminary'
        OperatingSystemName                  : 'iOS'

  - test:
      input:
        user_agent_string                    : 'Luminary/1.0.2 build 57/Android SDK 28'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Luminary'
        OperatingSystemName                  : 'Android'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Podcasts"'
      extract:
        - 'AgentName                         :   1000 : "Apple Podcasts"'

  - test:
      input:
        user_agent_string                    : 'Podcasts/3.5.1'
      expected:
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'
        DeviceClass                          : 'Mobile'

  - matcher:
      require:
        - 'agent.(3)product.(1)name="Mobile"'
        - 'agent.(4)product.(1)name="Pandora"'
      extract:
        - 'AgentName                         :   1000 :  agent.(4)product.(1)name'
        - 'DeviceClass                       :   1000 :  "Phone"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E302 Pandora/1902.1'
      expected:
        AgentName                            : 'Pandora'
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="facebookexternalhit"'
      extract:
        - 'DeviceClass                       :    110 :  "Robot"'
        - 'DeviceName                        :    110 :  "Facebook Robot"'
        - 'DeviceBrand                       :    110 :  "Facebook"'
        - 'OperatingSystemClass              :    110 :  "Unknown"'
        - 'OperatingSystemName               :    110 :  "Unknown"'
        - 'OperatingSystemVersion            :    100 :  "Unknown"'
        - 'AgentName                         :   2000 :  "Facebot"'

  - test:
      input:
        user_agent_string: 'facebookexternalhit/1.1 (+http://www.facebook.com/externalhit_uatext.php)'
      expected:
        AgentName                            : 'Facebot'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Podbean"'
        - 'agent.(1)product.(1)version="Android App"'
      extract:
        - 'AgentName                         :   1000 :  agent.(1)product.(1)name'
        - 'DeviceClass                       :   1000 :  "Mobile"'
        - 'OperatingSystemName               :   1000 :  "Android"'

  - test:
      input:
        user_agent_string: 'Podbean/Android App 6.2.1 (http://podbean.com),75b7fab34581539ef4029f2e9d6de2bf'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Podbean'
        OperatingSystemName                  : 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Podbean"'
        - 'agent.(1)product.(1)version="iOS"'
      extract:
        - 'AgentName                         :   1000 :  agent.(1)product.(1)name'
        - 'DeviceClass                       :   1000 :  "Mobile"'
        - 'OperatingSystemName               :   1000 :  agent.(1)product.(1)version'

  - test:
      input:
        user_agent_string: 'Podbean/iOS (http://podbean.com) 4.3.6 - 07268ca018ec49e614c5341c62d1e3c4'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Podbean'
        OperatingSystemName                  : 'iOS'


  - matcher:
      require:
        - 'agent.(1)product="Mozilla/5.0 (compatible; Google-Podcast)"'
        - 'agent.(1)product.(1)comments.(2)entry="Google-Podcast"'
      extract:
        - 'AgentName                         :   2000 :  "Google Play Music"'
        - 'DeviceClass                       :   1000 :  "Spider"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (compatible; Google-Podcast)'
      expected:
        DeviceClass                          : 'Spider'
        AgentName                            : 'Google Play Music'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent="doubleTwist CloudPlayer"'
      extract:
        - 'AgentName                         :   2000 :  "CloudPlayer"'
        - 'DeviceClass                       :   1000 :  "Unknown"'
        - 'OperatingSystemName               :   1000 :  "Android"'


  - test:
      input:
        user_agent_string: 'doubleTwist CloudPlayer'
      expected:
        AgentName                            : 'CloudPlayer'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Android'

  - matcher:
      require:
        - 'agent="Ubook Player"'
      extract:
        - 'AgentName                         :   2000 :  "Ubook Player"'
        - 'DeviceClass                       :   1000 :  "Unknown"'
        - 'OperatingSystemName               :   1000 :  "Unknown"'


  - test:
      input:
        user_agent_string: 'Ubook Player'
      expected:
        AgentName                            : 'Ubook Player'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent="ServeStream"'
      extract:
        - 'AgentName                         :   2000 :  "ServeStream"'
        - 'DeviceClass                       :   1000 :  "Unknown"'
        - 'OperatingSystemName               :   1000 :  "Android"'

  - test:
      input:
        user_agent_string: 'ServeStream'
      expected:
        AgentName                            : 'ServeStream'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Android'

  - matcher:
      require:
        - 'agent="Player FM"'
      extract:
        - 'AgentName                         :   2000 :  "Player FM"'
        - 'DeviceClass                       :   1000 :  "Unknown"'
        - 'OperatingSystemName               :   1000 :  "Unknown"'

  - test:
      input:
        user_agent_string: 'Player FM'
      expected:
        AgentName                            : 'Player FM'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent.(5)product="Spreaker/1.0"'
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry="Macintosh"'
        - 'agent.(4)product.(1)name="Safari"'
      extract:
        - 'AgentName                         :   2500 :  "SpreakerBot"'
        - 'DeviceClass                       :   1000 :  "Robot"'
        - 'OperatingSystemName               :   1000 :  "Mac OS"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_5) AppleWebKit/537.36 (KHTML,like Gecko) Chrome/53.0.6629.89 Safari/537.36 Spreaker/1.0'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'SpreakerBot'
        OperatingSystemName                   : 'Mac OS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Breaker"'
        - 'agent.(1)product.(1)version="iOS"'
        - 'agent.(1)product.(1)comments="(https://breaker.audio)"'

      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'OperatingSystemName                : 1000   :  agent.(1)product.(1)version'
        - 'DeviceClass                        : 1000   :  "Mobile"'
        - 'AgentNameVersionMajor              :  1000  :  agent.(1)product.(1)version'

  - test:
      input:
        user_agent_string: 'Breaker/iOS (https://breaker.audio) BMID/E68087883D'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'Breaker'
        OperatingSystemName                     : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Breaker"'

      extract:
        - 'AgentName                          :  1000   :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :  1000   :  "iOS"'
        - 'DeviceClass                        :  1000   :  "Mobile"'

  - test:
      input:
        user_agent_string: 'Breaker/0.7.10 (1034)'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'Breaker'
        OperatingSystemName                     : 'iOS'  # no android apk delivered yet


  - matcher:
      require:
        - 'agent.(1)product.(1)name="gPodder"'
        - 'agent.(2)product.(1)name="Windows"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name.(1)url="http://gpodder.org"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'OperatingSystemName                : 1000   :  agent.(2)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Desktop"'

  - test:
      input:
        user_agent_string: 'gPodder/3.10.3 (+http://gpodder.org/) Windows/10'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'gPodder'
        OperatingSystemName                     : 'Windows'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="gPodder"'
        - 'agent.(2)product.(1)name="Darwin"'
        - 'agent.(1)product.(1)comments="(+http://gpodder.org/)"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name.(1)url="http://gpodder.org"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'OperatingSystemName                : 1000   :  "Mac OS"'
        - 'DeviceClass                        : 1000   :  "Desktop"'

  - test:
      input:
        user_agent_string: 'gPodder/3.10.9 (+http://gpodder.org/) Darwin/19.0.0'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'gPodder'
        OperatingSystemName                     : 'Mac OS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="gPodder"'
        - 'agent.(2)product.(1)name="Linux"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name.(1)url="http://gpodder.org"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'OperatingSystemName                : 1000   :  agent.(2)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Desktop"'

  - test:
      input:
        user_agent_string: 'gPodder/3.10.1 (+http://gpodder.org/) Linux/4.15.0-50-generic'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'gPodder'
        OperatingSystemName                     : 'Linux'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="gPodder"'
        - 'IsNull[agent.(2)product.(1)name]'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name.(1)url="http://gpodder.org"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Desktop"'
        - 'OperatingSystemName                : 1000   :  "Unknown"'

  - test:
      input:
        user_agent_string: 'gPodder/4.6.0 (+http://gpodder.org/)'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'gPodder'
        OperatingSystemName                     : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Juice"'
        - 'agent.(1)product.(1)comments.(1)entry="Windows"'
        - 'agent.(2)product="http://juicereceiver.sf.net/"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Desktop"'
        - 'OperatingSystemName                : 1000   :  agent.(1)product.(1)comments.(1)entry'

  - test:
      input:
        user_agent_string: 'Juice/2.2 (Windows) +http://juicereceiver.sf.net/'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'Juice'
        OperatingSystemName                     : 'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="UCast"'
        - 'agent.(2)product.(1)name="Podcast Sync"'
        - 'agent.(2)product.(1)comments.(3)entry.(1)product.(1)name="http://www.ucastapp.com"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 2000   :  "Mobile"'
        - 'OperatingSystemName                : 1000   :  "iOS"'

  - test:
      input:
        user_agent_string: 'UCast/1.0 Podcast Sync (1 subscribers; feed-id=aHR0cDovL3d3dy5yYWRpb2NhYmxlLmNvbS9zZWNjaW9uZXMvYXVkaW8vZmVlZA77F85291-7393-4A39-8B98-CAD8E4A47564; +http://www.ucastapp.com/)'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'UCast'
        OperatingSystemName                     : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="UCast"'
        - 'agent.(2)product.(1)name="Podcast Sync"'
        - 'agent.(2)product.(1)comments.(2)entry.(1)product.(1)name="http://www.ucastapp.com"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 2000   :  "Mobile"'
        - 'OperatingSystemName                : 1000   :  "iOS"'

  - test:
      input:
        user_agent_string: 'UCast/1.0 Podcast Sync (feed-id=KG51bGwp; +http://www.ucastapp.com/)'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'UCast'
        OperatingSystemName                     : 'iOS'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spotify"'
        - 'IsNull[agent.(2)product.(1)name]'
      extract:
        - 'DeviceClass                        : 2000  : "Robot"'
  - test:
      input:
        user_agent_string                    : 'Spotify/1'
      expected:
        DeviceClass                          : 'Robot'
        AgentName                            : 'Spotify'
        OperatingSystemName                  : 'Unknown'

  - test:
      input:
        user_agent_string                    : 'Spotify/1.0'
      expected:
        DeviceClass                          : 'Robot'
        AgentName                            : 'Spotify'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spotify"'
        - 'agent.(2)product.(1)name="iOS"'
        - 'agent.(2)product.(1)comments.(1)entry.(1)text{"iPhone"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Phone"'
        - 'OperatingSystemName                : 1000   :  agent.(2)product.(1)name'

  - test:
      input:
        user_agent_string: 'Spotify/8.5.7 iOS/12.1.1 (iPhone10,6)'
      expected:
        DeviceClass                             : 'Phone'
        AgentName                               : 'Spotify'
        OperatingSystemName                     : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spotify"'
        - 'agent.(2)product.(1)comments.(1)entry.(1)text="PC laptop"'
        - 'agent.(2)product.(1)name="Win32"'
      extract:
        - 'DeviceClass                        :   2000 : "Desktop"'
        - 'AgentName                          :   1000 :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 :  "Windows"'
  - test:
      input:
        user_agent_string                    : 'Spotify/110500153 Win32/0 (PC laptop)'
      expected:
        DeviceClass                          : 'Desktop'
        AgentName                            : 'Spotify'
        OperatingSystemName                  : 'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spotify"'
        - 'agent.(2)product.(1)comments.(1)entry.(1)text="PC desktop"'
        - 'agent.(2)product.(1)name="Win32"'
      extract:
        - 'DeviceClass                        :   2000 : "Desktop"'
        - 'AgentName                          :   1000 :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :   1000 :  "Windows"'

  - test:
      input:
        user_agent_string                    : 'Spotify/110500153 Win32/0 (PC desktop)'
      expected:
        DeviceClass                          : 'Desktop'
        AgentName                            : 'Spotify'
        OperatingSystemName                  :  'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spotify"'
        - 'agent.(2)product.(1)name="OSX"'
      extract:
        - 'AgentName                          : 1000   : agent.(1)product.(1)name'
        - 'DeviceClass                        : 1000   : "Desktop"'
        - 'OperatingSystemName                : 1000   : "Mac OS"'

  - test:
      input:
        user_agent_string: 'Spotify/110900383 OSX/0 (iMac18,3)'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'Spotify'
        OperatingSystemName                     : 'Mac OS'

  - test:
      input:
        user_agent_string: 'Spotify/107700338 OSX/0 (MacBookAir6,2)'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'Spotify'
        OperatingSystemName                     : 'Mac OS'

  - test:
      input:
        user_agent_string: 'Spotify/1.0.0 OSX/10_14_1 (spclientd__device_hardware_model)'
      expected:
        DeviceClass                             : 'Desktop'
        AgentName                               : 'Spotify'
        OperatingSystemName                     : 'Mac OS'

  # yauaa Already validates anonymized user agent strings, and returns this trilogy
  - test:
      input:
        user_agent_string: ''
      expected:
        AgentName                               : 'Hacker'
        DeviceClass                             : 'Hacker'
        OperatingSystemName                     : 'Hacker'



  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(2)entry.(1)product.(1)name="Android"'
        - 'agent.(5)text="Bytespider"'
      extract:
        - 'AgentName                          : 2500   : agent.(5)text'
        - 'DeviceClass                        : 2000   : "Robot"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 6.0; Nexus 5 Build/MRA58N) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/59.0.1179.1295 Mobile Safari/537.36; Bytespider'
      expected:
        AgentName                               : 'Bytespider'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry{"Windows"'
        - 'agent.(5)text="Bytespider"'
      extract:
        - 'AgentName                          : 2500   : agent.(5)text'
        - 'OperatingSystemName                : 2500   : "Windows"'
        - 'DeviceClass                        : 2000   : "Robot"'
  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.9496.1000 Safari/537.36; Bytespider'
      expected:
        AgentName                               : 'Bytespider'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry="iPhone"'
        - 'agent.(5)text="Bytespider"'
      extract:
        - 'AgentName                          : 2500   : agent.(5)text'
        - 'OperatingSystemName                : 2500   : "iOS"'
        - 'DeviceClass                        : 2000   : "Robot"'
  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2836.1296 Mobile Safari/537.36; Bytespider'
      expected:
        AgentName                               : 'Bytespider'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry="Macintosh"'
        - 'agent.(5)text="Bytespider"'
      extract:
        - 'AgentName                          : 2500   : agent.(5)text'
        - 'OperatingSystemName                : 2500   : "Mac OS"'
        - 'DeviceClass                        : 2000   : "Robot"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.3262.1181 Safari/537.36; Bytespider'
      expected:
        AgentName                               : 'Bytespider'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'Mac OS'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry="Macintosh"'
        - 'agent.(5)text="Bytespider"'
      extract:
        - 'AgentName                          : 2500   : agent.(5)text'
        - 'OperatingSystemName                : 2500   : "Mac OS"'
        - 'DeviceClass                        : 2000   : "Robot"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)product.(1)name{"Windows"'
        - 'agent.(4)product.(1)comments.(1)entry="StatusCake"'
      extract:
        - 'AgentName                          : 2500   : agent.(4)product.(1)comments.(1)entry'
        - 'OperatingSystemName                : 2500   : "Windows"'
        - 'DeviceClass                        : 2000   : "Robot"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/98 Safari/537.4 (StatusCake)'
      expected:
        AgentName                               : 'StatusCake'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'Windows'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="WhatsApp"'
        - 'IsNull[agent.(1)product.(1)comments.(3)entry]'
      extract:
        - 'AgentName                          : 1000   : "Robot"'
        - 'OperatingSystemName                : 1000   : "Unknown"'
        - 'DeviceClass                        : 1000   : "Robot"'

  - test:
      input:
        user_agent_string: 'WhatsApp/2.19.175 A'
      expected:
        AgentName                               : 'Robot'
        DeviceClass                             : 'Robot'
        OperatingSystemName                     : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(3)entry="http://www.whatsapp.com/contact"'
      extract:
        - 'OperatingSystemName                : 1000   : "Unknown"'
        - 'DeviceClass                        : 1000   : "Unknown"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (compatible; WAChat/1.2; +http://www.whatsapp.com/contact)'
      expected:
        AgentName                               : 'WAChat'
        DeviceClass                             : 'Unknown'
        OperatingSystemName                     : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)product.(1)name?Bots'
      extract:
        - 'DeviceClass                        :   2000 : "Robot"'
        - 'AgentName                          :   2000 :  agent.(1)product.(1)name'
        - 'OperatingSystemName                :   2000 : "Unknown"'

  - test:
      input:
        user_agent_string                    : 'Go-http-client/1.1'
      expected:
        AgentName                            : 'Go-http-client'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Unknown'

  - test:
      input:
        user_agent_string: 'fyyd-poll/0.1c'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'fyyd-poll'
        OperatingSystemName                   : 'Unknown'

  - test:
      input:
        user_agent_string: 'Apache-HttpClient/4.5.2 (Java/1.8.0_181)'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'Apache-HttpClient'
        OperatingSystemName                   : 'Unknown'


  - test:
      input:
        user_agent_string: 'Python-urllib/3.6'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'Python-urllib'
        OperatingSystemName                   : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)text?LibsynBots'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
      extract:
        - 'DeviceClass                        :   2000 : "Robot"'
        - 'OperatingSystemName                :   2000 : "Unknown"'
        - 'AgentName                          :   1000 : "LibsynBot"'

  - test:
      input:
        user_agent_string: 'Libsyn4-Download'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'LibsynBot'
        OperatingSystemName                   : 'Unknown'

  - test:
      input:
        user_agent_string: 'Libsyn4-Peek'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'LibsynBot'
        OperatingSystemName                   : 'Unknown'

  - test:
      input:
        user_agent_string: 'Libsyn4Peek'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'LibsynBot'
        OperatingSystemName                   : 'Unknown'

  - test:
      input:
        user_agent_string: 'Libsyn4-peek'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'LibsynBot'
        OperatingSystemName                   : 'Unknown'

  - test:
      input:
        user_agent_string: 'Libsyn3'
      expected:
        DeviceClass                           : 'Robot'
        AgentName                             : 'LibsynBot'
        OperatingSystemName                   : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="LinkedInBot"'
        - 'agent.(1)product.(1)comments.(3)entry.(1)product.(1)name="Apache-HttpClient"'
        - 'agent.(1)product.(1)comments.(3)entry.(1)product.(1)version.(1)url="http://www.linkedin.com"'
      extract:
        - 'DeviceClass                        :   1000 : "Robot"'
        - 'OperatingSystemName                :   1000 : "Unknown"'
        - 'AgentName                          :   1000 :  agent.(1)product.(1)name'

  - test:
      input:
        user_agent_string                    : 'LinkedInBot/1.0 (compatible; Mozilla/5.0; Apache-HttpClient +http://www.linkedin.com)'
      expected:
        AgentName                            : 'LinkedInBot'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(1)product.(1)comments.(4)entry="web-crawlers+links@hubspot.com"'
      extract:
        - 'DeviceClass                        :   1000 : "Robot"'
        - 'OperatingSystemName                :   1000 : agent.(1)product.(1)comments.(2)entry.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (X11; Linux x86_64; HubSpot Single Page link check; web-crawlers+links@hubspot.com) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36'
      expected:
        AgentName                            : 'Chrome'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Linux'

  - matcher:
      require:
        - 'agent.(1)text{"Lavf"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
      extract:
        - 'DeviceClass                        :   2000 : "Unknown"'
        - 'OperatingSystemName                :   2000 : "Unknown"'
        - 'AgentName                          :   1000 : "ffmpeg"'

  - test:
      input:
        user_agent_string: 'Lavf52.104.0'
      expected:
        AgentName                            : 'ffmpeg'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="GuzzleHttp"'
        - 'agent.(2)product.(1)name="curl"'
        - 'agent.(3)product.(1)name="PHP"'
        - 'agent.(3)product.(1)version~"ubuntu"'
      extract:
        - 'DeviceClass                        :   3500 : "Robot"'
        - 'OperatingSystemName                :   3500 : "Linux"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'GuzzleHttp/6.1.0 curl/7.50.1 PHP/7.0.13-0ubuntu0.16.10.1'
      expected:
        AgentName                            : 'GuzzleHttp'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Linux'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Bullhorn"'
        - 'agent.(1)product.(1)comments.(1)entry="http://bullhorn.fm/"'
      extract:
        - 'DeviceClass                        :   3500 : "Unknown"'
        - 'OperatingSystemName                :   3500 : "Unknown"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'Bullhorn/1.0 (+http://bullhorn.fm/)'
      expected:
        AgentName                            : 'Bullhorn'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)text{"SoundWaves"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'DeviceClass                        :   3500 : "Mobile"'
        - 'OperatingSystemName                :   3500 : "Android"'
        - 'AgentName                          :   3000 : "SoundWaves"'

  - test:
      input:
        user_agent_string: 'SoundWaves-0.160.2'
      expected:
        AgentName                            : 'SoundWaves'
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'Android'


  - matcher:
      require:
        - 'agent.(1)text="TuneIn Radio"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'DeviceClass                        :   3500 : "Unknown"'
        - 'OperatingSystemName                :   3500 : "Unknown"'
        - 'AgentName                          :   1000 : agent.(1)text'

  - test:
      input:
        user_agent_string: 'TuneIn Radio'
      expected:
        AgentName                            : 'TuneIn Radio'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'

  - matcher:
      require:
        - 'agent.(1)text="myTuner Radio Pro"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'DeviceClass                        :   3500 : "Unknown"'
        - 'OperatingSystemName                :   3500 : "Unknown"'
        - 'AgentName                          :   1000 : agent.(1)text'

  - test:
      input:
        user_agent_string: 'myTuner Radio Pro'
      expected:
        AgentName                            : 'myTuner Radio Pro'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'



  - matcher:
      require:
        - 'agent.(2)product.(1)name="Alamofire"'
        - 'agent.(1)product.(1)comments.(3)entry.(1)product.(1)name="iOS"'
      extract:
        - 'AgentName                          : 1000   :  agent.(1)product.(1)name'
        - 'DeviceClass                        : 1000   :  "Mobile"'
        - 'OperatingSystemName                : 1000   :  agent.(1)product.(1)comments.(3)entry.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'Radio.com/8.7.1 (com.cbsradio.cbsradioplayer; build:1; iOS 12.3.1) Alamofire/4.5.0'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'Radio.com'
        OperatingSystemName                     : 'iOS'

  - test:
      input:
        user_agent_string: 'OwlTail/1.3 (com.owltail.app; build:19; iOS 12.3.1) Alamofire/4.7.3'
      expected:
        DeviceClass                             : 'Mobile'
        AgentName                               : 'OwlTail'
        OperatingSystemName                     : 'iOS'

  - matcher:
      require:
        - 'agent.(1)text="NPROneAndroid"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'DeviceClass                        :   3500 : "Mobile"'
        - 'OperatingSystemName                :   3500 : "Android"'
        - 'AgentName                          :   1000 : agent.(1)text'

  - test:
      input:
        user_agent_string: 'NPROneAndroid'
      expected:
        AgentName                            : 'NPROneAndroid'
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'Android'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="RadioPublic iOS"'
      extract:
        - 'DeviceClass                        :   3500 : "Mobile"'
        - 'OperatingSystemName                :   3500 : "iOS"'
        - 'AgentName                          :   1000 : "RadioPublic"'

  - test:
      input:
        user_agent_string: 'RadioPublic iOS 1.9.10'
      expected:
        AgentName                            : 'RadioPublic'
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'iOS'



  - matcher:
      require:
        - 'agent.(1)text="Pocket Casts"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'DeviceClass                        :   3500 : "Mobile"'
        - 'OperatingSystemName                :   3500 : "Unknown"'
        - 'AgentName                          :   1000 : agent.(1)text'

  - test:
      input:
        user_agent_string: 'Pocket Casts'
      expected:
        AgentName                            : 'Pocket Casts'
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'Unknown'

  # rocco comments
  - matcher:
      require:
        - 'agent.(1)text="Podcoin"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'AgentName                         :   1000 :  "Podcoin"'
        - 'DeviceClass                       :   1000 :  "Unknown"'
        - 'OperatingSystemName                :  1000 : "Unknown"'
  - test:
      input:
        user_agent_string: 'Podcoin'
      expected:
        AgentName                            : 'Podcoin'
        DeviceClass                          : 'Unknown'
        OperatingSystemName                  : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)text="AmazonNewsContentService"'
        - 'IsNull[agent.(1)product.(1)version]'
        - 'IsNull[agent.(1)product.(1)comments]'
        - 'IsNull[agent.url]'
        - 'IsNull[agent.product]'
      extract:
        - 'AgentName                         :   1000 :  "Alexa Media Player"'
        - 'DeviceClass                       :   1000 :  "Smart Speaker"'
        - 'OperatingSystemName                :  1000 : "Amazon Alexa"'
  - test:
      input:
        user_agent_string: 'AmazonNewsContentService'
      expected:
        AgentName                            : 'Alexa Media Player'
        DeviceClass                          : 'Smart Speaker'
        OperatingSystemName                  : 'Amazon Alexa'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Miro"'
        - 'agent.(1)product.(1)comments.(2)entry.(1)product.(1)name="Windows"'
        - 'agent.(1)product.(1)comments.(1)entry="http://www.getmiro.com/"'
      extract:
        - 'AgentName                         :   1000 : "Miro"'
        - 'DeviceClass                       :   1000 : "Desktop"'
        - 'OperatingSystemName                :  1000 : "Windows"'
  - test:
      input:
        user_agent_string: 'Miro/6.0 (http://www.getmiro.com/; Windows post2008Server x86)'
      expected:
        AgentName                            : 'Miro'
        DeviceClass                          : 'Desktop'
        OperatingSystemName                  : 'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="curl"'
      extract:
        - 'DeviceClass                        :   3500 : "Robot"'
        - 'OperatingSystemName                :   3500 : "Unknown"'
        - 'AgentName                          :   1000 : agent.(1)product.(1)name'

  - test:
      input:
        user_agent_string: 'curl/7.51.0'
      expected:
        AgentName                            : 'curl'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Unknown'
  - test:
      input:
        user_agent_string: 'curl/7.19.4%20(i386-redhat-linux-gnu)%20libcurl/7.19.4%20NSS/3.12.2.0%20zlib/1.2.3%20libidn/0.6.14%20libssh2/0.18'
      expected:
        AgentName                            : 'curl'
        DeviceClass                          : 'Robot'
        OperatingSystemName                  : 'Unknown'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="python-requests"'
        - 'IsNull[agent.(2)product.(1)name]'
      extract:
        - 'DeviceClass                        : 2000  : "Robot"'
  - test:
      input:
        user_agent_string: 'python-requests/2.18.1'
      expected:
        DeviceClass                          : 'Robot'
        AgentName                            : 'python-requests'
        OperatingSystemName                  : 'Unknown'

  ### Facebook
  - matcher:
      require:
        - 'agent.product.comments.entry.(1)product.(1)name="FBAN"'
      extract:
        - 'AgentName                          :   4000 :"Facebook"'

  - matcher:
      require:
        - 'agent.product.comments.entry.(1)product.(1)name="FB_IAB"'
      extract:
        - 'AgentName                          :   4000 :"Facebook"'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.2; GT-I9505 Build/KOT49H) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/30.0.0.0 Mobile Safari/537.36 [FB_IAB/FB4A;FBAV/28.0.0.20.16;]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Phone'
        OperatingSystemName : 'Android'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 8_2 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12D508 [FBAN/FBIOS;FBAV/27.0.0.10.12;FBBV/8291884;FBDV/iPad4,1;FBMD/iPad;FBSN/iPhone OS;FBSV/8.2;FBSS/2; FBCR/;FBID/tablet;FBLC/nl_NL;FBOP/1]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Tablet'
        OperatingSystemName : 'iOS'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 8_1_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12B435 [FBAN/FBIOS;FBAV/26.0.0.11.13;FBBV/7806348;FBDV/iPad4,2;FBMD/iPad;FBSN/iPhone OS;FBSV/8.1.1;FBSS/2; FBCR/TelfortNL;FBID/tablet;FBLC/nl_NL;FBOP/1]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Tablet'
        OperatingSystemName : 'iOS'

  - test:
      input:
        user_agent_string: '(null) [FBAN/FBIOS;FBAV/50.0.0.47.191;FBBV/23973043;FBDV/iPad4,4;FBMD/iPad;FBSN/iPhone OS;FBSV/8.0.2;FBSS/2; FBCR/;FBID/tablet;FBLC/nl_NL;FBOP/1]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Tablet'
        OperatingSystemName : 'iOS'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 9_3_2 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Mobile/13F69 [FBAN/MessengerForiOS;FBAV/73.0.0.33.71;FBBV/31011105;FBRV/0;FBDV/iPhone7,2;FBMD/iPhone;FBSN/iPhone OS;FBSV/9.3.2;FBSS/2;FBCR/OrangeB;FBID/phone;FBLC/nl_NL;FBOP/5]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Phone'
        OperatingSystemName : 'iOS'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 4.4.4; SM-G901F Build/KTU84P) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/33.0.0.0 Mobile Safari/537.36 [FBAN/FB4A;FBAV/20.0.0.25.15;]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Phone'
        OperatingSystemName : 'Android'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPhone; CPU iPhone OS 12_3_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 [FBAN/FBIOS;FBDV/iPhone10,2;FBMD/iPhone;FBSN/iOS;FBSV/12.3.2;FBSS/3;FBCR/Verizon;FBID/phone;FBLC/en_US;FBOP/5]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Phone'
        OperatingSystemName : 'iOS'

  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (iPad; CPU OS 12_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 [FBAN/FBIOS;FBDV/iPad5,3;FBMD/iPad;FBSN/iOS;FBSV/12.3.1;FBSS/2;FBCR/;FBID/tablet;FBLC/en_US;FBOP/5]'
      expected:
        AgentName           : 'Facebook'
        DeviceClass         : 'Tablet'
        OperatingSystemName : 'iOS'


  ### Windows Media Player
  - matcher:
      require:
        - 'agent.product.(1)name="WMFSDK"'
      extract:
        - 'AgentName                          :   4000 :"Windows Media Player"'
        - 'DeviceClass                        :   4000 :"Desktop"'
        - 'OperatingSystemName                :   4000 :"Windows"'

  - test:
      input:
        user_agent_string: 'NSPlayer/12.00.18362.0175 WMFSDK/12.00.18362.0175'
      expected:
        AgentName           : 'Windows Media Player'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="AppleCoreMedia"'
        - 'agent.(1)product.(1)comments.(1)entry?AppleTV'
        - 'agent.(1)product.(1)comments.(3)entry.(2)text="like Mac OS X"'
      extract:
        - 'DeviceClass                        : 2000  : "TV"'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16M153 (Apple TV; U; CPU OS 12_3 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16L250 (Apple TV; U; CPU OS 12_2_1 like Mac OS X; he_il)'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16M153 (AppleTV; U; CPU OS 12_3 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16M153 (Apple tv; U; CPU OS 12_3 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="AppleCoreMedia"'
        - 'agent.(1)product.(1)comments.(1)entry="HomePod"'
        - 'agent.(1)product.(1)comments.(3)entry.(2)text="like Mac OS X"'
      extract:
        - 'DeviceClass                        : 2000  : "Smart Speaker"'
        - 'AgentName                          : 2000  : "Apple Podcasts"'

  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16F156 (HomePod; U; CPU OS 12_3 like Mac OS X; es_es)'
      expected:
        DeviceClass                          : 'Smart Speaker'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Mozilla"'
        - 'agent.(2)product.(1)name="AppleWebKit"'
        - 'agent.(3)product.(1)name="Chrome"'
        - 'agent.(4)product.(1)name="Safari"'
        - 'agent.(5)product.(1)name="CrKey"'
      extract:
        - 'DeviceClass                        : 3000  : "TV"'
        - 'AgentName                          : 3000  : "Chromecast"'
  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (X11; Linux armv7l) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.47 Safari/537.36 CrKey/1.36.146299'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Chromecast'
        OperatingSystemName                  : 'Linux'
  - test:
      input:
        user_agent_string: 'Mozilla/5.0 (Linux; Android 8.0; Build/OPR6.170623.010) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.47 Safari/537.36 CrKey/1.36.154871'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Chromecast'
        OperatingSystemName                  : 'Android'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Roku"'
      extract:
        - 'DeviceClass                        : 2000  : "TV"'
        - 'AgentName                          : 2000  : agent.(1)product.(1)name'
        - 'OperatingSystemName                : 1000 : "Roku OS"'
  - test:
      input:
        user_agent_string: 'Roku/DVP-9.10 (049.10E04111A)'
      expected:
        DeviceClass                          : 'TV'
        AgentName                            : 'Roku'
        OperatingSystemName                  : 'Roku OS'

  #### iTunes Mac OS X

  - matcher:
      require:
        - 'agent.(1)product.(1)name="iTunes"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)text="Macintosh"'
      extract:
        - 'AgentName                          :   4000 :"iTunes"'
        - 'DeviceClass                        :   4000 :"Desktop"'
        - 'OperatingSystemName                :   4000 :"Mac OS"'

  - test:
      input:
        user_agent_string: 'iTunes/12.9.5 (Macintosh; OS X 10.14.5) AppleWebKit/607.2.6.1.1'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Mac OS'

  #### iTunes Windows

  - matcher:
      require:
        - 'agent.(1)product.(1)name="iTunes"'
        - 'agent.(1)product.(1)comments.(1)entry.(1)text="Windows"'
      extract:
        - 'AgentName                          :   4000 :"iTunes"'
        - 'DeviceClass                        :   4000 :"Desktop"'
        - 'OperatingSystemName                :   4000 :"Windows"'

  - test:
      input:
        user_agent_string: 'iTunes/12.9.5 (Windows; Microsoft Windows 10 x64 Home Premium Edition (Build 17134); x64) AppleWebKit/7607.2006.2001.1'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes/12.9.5 (Windows; Microsoft Windows 10 x64 (Build 17763); x64) AppleWebKit/7607.2006.2001.1'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes/12.8 (Windows; Microsoft Windows 7 x64 Ultimate Edition Service Pack 1 (Build 7601); x64) AppleWebKit/7605.3008.0.20'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes/12.4.3 (Windows; Microsoft Windows 8.1 Home Premium Edition (Build 9200)) AppleWebKit/7601.6016.1000.7'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes/12.2.2 (Windows; Microsoft Windows 8 x64 Home Premium Edition (Build 9200); x64) AppleWebKit/7605.3008.0.20'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'

  - test:
      input:
        user_agent_string: 'iTunes/9.2.1 (Windows; (Build 9200)) AppleWebKit/533.16'
      expected:
        AgentName           : 'iTunes'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Windows'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="AppleCoreMedia"'
        - 'agent.(1)product.(1)comments.(1)entry="iPod"'
      extract:
        - 'DeviceClass                        : 2000  : "Mobile"'

  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.8C148 (iPod; U; CPU OS 4_2_1 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'


  - matcher:
      require:
        - 'agent.(1)product.(1)name="AppleCoreMedia"'
        - 'agent.(1)product.(1)comments.(1)entry="iPod touch"'
      extract:
        - 'DeviceClass                        : 2000  : "Mobile"'

  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.9A405 (iPod touch; U; CPU OS 5_0_1 like Mac OS X; en_us)'
      expected:
        DeviceClass                          : 'Mobile'
        AgentName                            : 'Apple Podcasts'
        OperatingSystemName                  : 'iOS'

  # All AppleCoreMedia* agents considered to be Apple Podcasts
  - matcher:
      require:
        - 'agent.product.name~"AppleCoreMedia"'
      extract:
        - 'AgentName                          :   5000 :"Apple Podcasts"'

  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.11D258 (Apple TV; U; CPU OS 7_1_2 like Mac OS X; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'TV'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16M153 (Apple TV; U; CPU OS 12_3 like Mac OS X; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'TV'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16S46 (Apple Watch; U; CPU OS 5_1_2 like Mac OS X; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Smart Watch'
        OperatingSystemName : 'WatchOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.16D39 (HomePod; U; CPU OS 12_1_3 like Mac OS X; es_es)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Smart Speaker'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.10A523 (iPad; U; CPU OS 6_0_1 like Mac OS X; en_gb)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Tablet'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.10A523 (iPhone; U; CPU OS 6_0_1 like Mac OS X; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Phone'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.10A523 (iPod; U; CPU OS 6_0_1 like Mac OS X; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Mobile'
        OperatingSystemName : 'iOS'
  - test:
      input:
        user_agent_string: 'AppleCoreMedia/1.0.0.11G63 (Macintosh; U; Intel Mac OS X 10_7_5; en_us)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Desktop'
        OperatingSystemName : 'Mac OS X'
  - test:
      input:
        user_agent_string: '(null)/(null) watchOS/5.0 model/Watch2,3 hwp/t8002 build/16R364 (6; dt:133)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Smart Watch'
        OperatingSystemName : 'WatchOS'
  - test:
      input:
        user_agent_string: 'atc/1.0 watchOS/5.1.2 model/Watch2,3 hwp/t8002 build/16S46 (6; dt:133)'
      expected:
        AgentName           : 'Apple Podcasts'
        DeviceClass         : 'Smart Watch'
        OperatingSystemName : 'WatchOS'


      ########## Spreaker Android world

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="phone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker for Android"'
        - 'IsNull[agent.(1)product.(3)version.(1)keyvalue.(2)text]'
        - 'agent.(1)product.(1)comments.(1)entry!="Android SMART_TV"'
      extract:
        - 'DeviceClass                         :   2000 :"Mobile"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker for Android"'
        - 'IsNull[agent.(1)product.(3)version.(1)keyvalue.(2)text]'
        - 'agent.(1)product.(1)comments.(1)entry="Android SMART_TV"'
      extract:
        - 'DeviceClass                         :   2000 :"TV"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker Studio for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="phone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Studio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="tablet"'
      extract:
        - 'DeviceClass                         :   2000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker Studio for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="tablet"'
      extract:
        - 'DeviceClass                         :   2000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Studio"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker Custom App for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="phone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Custom App"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - matcher:
      require:
        - 'agent.(1)product.name="Spreaker Custom App for Android"'
        - 'agent.(1)product.(3)version.(1)keyvalue.(2)text="tablet"'
      extract:
        - 'DeviceClass                         :   2000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Custom App"'
        - 'OperatingSystemName                 :   1000 :"Android"'

  - test:
      input:
        user_agent_string: 'Spreaker for Android 4.10.5 release:2018-12-03 device:phone (google Pixel 2; Android 9; it_IT)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker for Android 5.3.2 release:2018-12-03 device:phone (google Pixel 2; Android 9; it_IT)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker for Android 4.4.0 release:2017-01-30 device:tablet (google Nexus 9; Android 7.1.1; en_US)")'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker Studio for Android 4.4.0-DEV release:2017-01-30 device:phone (google Nexus 9; Android 7.1.1; en_US)")'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Studio'

  - test:
      input:
        user_agent_string: 'Spreaker Studio for Android 4.4.0-DEV release:2017-01-30 device:tablet (google Nexus 9; Android 7.1.1; en_US)")'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Studio'

  - test:
      input:
        user_agent_string: 'Spreaker Custom App for Android 5.2.3 release:2018-07-26 device:phone (google Pixel 2; Android 9; en_US)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Custom App'

  - test:
      input:
        user_agent_string: 'Spreaker Custom App for Android 5.2.3 release:2018-07-26 device:tablet (google Nexus 9; Android 7.1.1; en_US)'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Custom App'


  ########## Spreaker Apple world

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker"'
        - 'agent.(1)product.(1)comments{"(iPhone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker"'
        - 'agent.(1)product.(1)comments{"(iPad"'
      extract:
        - 'DeviceClass                         :   3000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker"'
        - 'agent.(1)product.(1)comments{"(iPod"'
      extract:
        - 'DeviceClass                         :   2000 :"Mobile"'
        - 'AgentName                           :   1000 :"Spreaker Radio"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - test:
      input:
        user_agent_string: 'Spreaker 7.16.1 rv:1283 (iPhone9,4; iOS 11.4.1; it_IT) SPKAudioPlayer'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker 1.0.2 (iPhone; iPhone OS 4.2.1; it_IT)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker 1.2 rv:1.2.0 (iPod touch; iPhone OS 4.2.1; en_GB)'
      expected:
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Radio'

  - test:
      input:
        user_agent_string: 'Spreaker 7.8 rv:1261 (iPad5,3; iOS 12.3.1; en_US)'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Radio'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Studio"'
        - 'agent.(1)product.(1)comments{"(iPhone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Studio"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Studio"'
        - 'agent.(1)product.(1)comments{"(iPad"'
      extract:
        - 'DeviceClass                         :   3000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Studio"'
        - 'OperatingSystemName                 :   1000 :"iOS"'


  - test:
      input:
        user_agent_string: 'Studio 3.0 rv:259 (iPhone3,3; iPhone OS 7.1.2; en_US)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Studio'

  - test:
      input:
        user_agent_string: 'Studio 3.0.1 rv:260 (iPad3,4; iPhone OS 8.2; es_MX)'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Studio'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker Custom App for iOS"'
        - 'agent.(1)product.(1)comments{"(iPod"'
      extract:
        - 'DeviceClass                         :   2000 :"Mobile"'
        - 'AgentName                           :   1000 :"Spreaker Custom App"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker Custom App for iOS"'
        - 'agent.(1)product.(1)comments{"(iPad"'
      extract:
        - 'DeviceClass                         :   2000 :"Tablet"'
        - 'AgentName                           :   1000 :"Spreaker Custom App"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - matcher:
      require:
        - 'agent.(1)product.(1)name="Spreaker Custom App for iOS"'
        - 'agent.(1)product.(1)comments{"(iPhone"'
      extract:
        - 'DeviceClass                         :   2000 :"Phone"'
        - 'AgentName                           :   1000 :"Spreaker Custom App"'
        - 'OperatingSystemName                 :   1000 :"iOS"'

  - test:
      input:
        user_agent_string: 'Spreaker Custom App for iOS 1.0 rv:2 (iPod5,1; iPhone OS 8.2; en_US)'
      expected:
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Custom App'

  - test:
      input:
        user_agent_string: 'Spreaker Custom App for iOS 2.2.2 rv:6302 (iPhone11,6; iOS 12.3.1; en_US)'
      expected:
        DeviceClass                          : 'Phone'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Custom App'

  - test:
      input:
        user_agent_string: 'Spreaker Custom App for iOS 2.0.7 rv:5407 (iPad3,4; iOS 10.3.3; es_MX)'
      expected:
        DeviceClass                          : 'Tablet'
        OperatingSystemName                  : 'iOS'
        AgentName                            : 'Spreaker Custom App'

  - test:
      input:
        user_agent_string: 'Spreaker for Android 4.3.4 release:2016-12-12 (nubia NX595J; Android 7.1.1; zh_CN)'
      expected:
        DeviceClass                          : 'Mobile'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Radio'


  - test:
      input:
        user_agent_string: 'Spreaker for Android 4.2.7 release:2016-05-25 (Android SMART_TV; Android 7.0; en_US)'
      expected:
        DeviceClass                          : 'TV'
        OperatingSystemName                  : 'Android'
        AgentName                            : 'Spreaker Radio'


  - test:
      input:
        user_agent_string: 'Spreaker for Android 4.2.7 release:2016-05-25 (LGE Optimus One; Android 4.4.2; es_ES)'
      expected:
        DeviceClass: 'Mobile'
        OperatingSystemName: 'Android'
        AgentName: 'Spreaker Radio'
